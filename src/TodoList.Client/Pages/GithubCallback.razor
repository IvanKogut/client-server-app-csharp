@page "/github-callback"

@using API.Models;
@using Blazored.LocalStorage;

@inject IUriHelper UriHelper
@inject IJSRuntime JsRuntime
@inject IAppHttpClient AppHttpClient
@inject ILocalStorageService LocalStorageService

@functions {

  protected override async Task OnInitAsync()
  {
    UserExternalLoginModel model = new UserExternalLoginModel
    {
      Code = await JsRuntime.InvokeAsync<string>("getQueryParameterValue", "code")
    };

    ApiCallResult<string> githubCallResult = await AppHttpClient.PostAsync<string>(ApiUrls.LoginByGithub, model);

    await LocalStorageService.SetItemAsync(AppState.AuthTokenKey, githubCallResult.Value);

    UriHelper.NavigateTo(string.Empty);
  }
}
