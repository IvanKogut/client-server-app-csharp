@page "/google-callback"

@using API.Models;
@using Blazored.LocalStorage;

@inject IUriHelper UriHelper
@inject IJSRuntime JsRuntime
@inject IAppHttpClient AppHttpClient
@inject ILocalStorageService LocalStorageService

@functions {

  protected override async Task OnInitAsync()
  {
    UserExternalLoginModel model = new UserExternalLoginModel
    {
      Code = await JsRuntime.InvokeAsync<string>("getQueryParameterValue", "code"),
      RedirectUri = "https://localhost:44328/google-callback"
    };

    ApiCallResult<string> googleCallResult = await AppHttpClient.PostAsync<string>(ApiUrls.LoginByGoogle, model);

    await LocalStorageService.SetItemAsync(AppState.AuthTokenKey, googleCallResult.Value);

    UriHelper.NavigateTo(string.Empty);
  }
}
